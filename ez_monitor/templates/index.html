<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Metrics Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #000;
            color: #fff;
            margin: 0;
            padding: 20px;
        }
        .dashboard {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .metric-container {
            width: calc(33% - 14px); /* Adjusted for 3 columns */
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            box-sizing: border-box;
        }
        .progress-bar {
            position: relative;
            width: 100%;
            height: 30px;
            background-color: #333;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .progress {
            height: 100%;
            width: 0;
            transition: width 0.5s ease-in-out, background-color 0.5s ease-in-out;
        }
        .label {
            margin-bottom: 10px;
            font-size: 18px;
            font-weight: bold;
            height: 30px; /* Set a fixed height for all label areas */
            display: flex;
            align-items: center;
        }
        .info {
            font-size: 14px;
            margin-top: 10px;
            background-color: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 5px;
        }
        .value-box {
            display: inline-block;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 5px 10px;
            border-radius: 5px;
            margin-right: 10px;
            margin-bottom: 5px;
        }
        .dynamic-info {
            display: inline-block;
        }
        .max-line {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 3px;
            background-color: rgba(255, 255, 255, 1); /* Fully opaque white */
            display: none;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.8); /* Increased glow effect */
        }
        .percentage-axis {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 1px;
            background-color: rgba(255, 255, 255, 0.2);
        }
        .percentage-label {
            position: absolute;
            bottom: -20px;
            transform: translateX(-50%);
            font-size: 10px;
            color: rgba(255, 255, 255, 0.5);
        }
        .disk-selector {
            margin-left: auto;
            font-size: 14px;
        }
        select {
            background-color: #333;
            color: #fff;
            border: none;
            padding: 2px 5px;
            border-radius: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="metric-container">
            <div class="label">CPU</div>
            <div class="progress-bar">
                <div id="cpuProgress" class="progress"></div>
                <div id="cpuMaxLine" class="max-line"></div>
                <div class="percentage-axis" style="left: 25%"><span class="percentage-label">25%</span></div>
                <div class="percentage-axis" style="left: 50%"><span class="percentage-label">50%</span></div>
                <div class="percentage-axis" style="left: 75%"><span class="percentage-label">75%</span></div>
            </div>
            <div id="cpuPercent" class="value-box"></div>
            <div id="cpuDynamicInfo" class="dynamic-info"></div>
            <div id="cpuInfo" class="info"></div>
        </div>
        <div class="metric-container">
            <div class="label">Memory</div>
            <div class="progress-bar">
                <div id="memoryProgress" class="progress"></div>
                <div id="memoryMaxLine" class="max-line"></div>
                <div class="percentage-axis" style="left: 25%"><span class="percentage-label">25%</span></div>
                <div class="percentage-axis" style="left: 50%"><span class="percentage-label">50%</span></div>
                <div class="percentage-axis" style="left: 75%"><span class="percentage-label">75%</span></div>
            </div>
            <div id="memoryPercent" class="value-box"></div>
            <div id="memoryUsage" class="value-box"></div>
            <div id="memoryInfo" class="info"></div>
        </div>
        <div class="metric-container">
            <div class="label">
                Disk
                <select id="diskSelector" class="disk-selector">
                    {% for disk in disks %}
                    <option value="{{ disk }}">{{ disk }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="progress-bar">
                <div id="diskProgress" class="progress"></div>
                <div id="diskMaxLine" class="max-line"></div>
                <div class="percentage-axis" style="left: 25%"><span class="percentage-label">25%</span></div>
                <div class="percentage-axis" style="left: 50%"><span class="percentage-label">50%</span></div>
                <div class="percentage-axis" style="left: 75%"><span class="percentage-label">75%</span></div>
            </div>
            <div id="diskPercent" class="value-box"></div>
            <div id="diskUsage" class="value-box"></div>
            <div id="diskInfo" class="info"></div>
        </div>
        <div class="metric-container">
            <div class="label">Disk I/O</div>
            <div class="progress-bar">
                <div id="diskIOProgress" class="progress"></div>
                <div id="diskIOMaxLine" class="max-line"></div>
                <div class="percentage-axis" style="left: 25%"><span class="percentage-label">25%</span></div>
                <div class="percentage-axis" style="left: 50%"><span class="percentage-label">50%</span></div>
                <div class="percentage-axis" style="left: 75%"><span class="percentage-label">75%</span></div>
            </div>
            <div id="diskIOPercent" class="value-box"></div>
            <div id="diskIOInfo" class="info"></div>
        </div>
        <div class="metric-container">
            <div class="label">Network Usage</div>
            <div class="progress-bar">
                <div id="networkProgress" class="progress"></div>
                <div id="networkMaxLine" class="max-line"></div>
                <div class="percentage-axis" style="left: 25%"><span class="percentage-label">25%</span></div>
                <div class="percentage-axis" style="left: 50%"><span class="percentage-label">50%</span></div>
                <div class="percentage-axis" style="left: 75%"><span class="percentage-label">75%</span></div>
            </div>
            <div id="networkPercent" class="value-box"></div>
            <div id="networkInfo" class="info"></div>
        </div>
    </div>

    <script>
        let cpuMax = 0;
        let memoryMax = 0;
        let diskMax = 0;
        let diskIOMax = 0;
        let networkMax = 0;
        const diskSelector = document.getElementById('diskSelector');

        function updateCPUMetric(cpu) {
            const progress = document.getElementById('cpuProgress');
            const percentElement = document.getElementById('cpuPercent');
            const infoElement = document.getElementById('cpuInfo');
            const dynamicInfoElement = document.getElementById('cpuDynamicInfo');
            const maxLine = document.getElementById('cpuMaxLine');
            
            progress.style.width = `${cpu.usage}%`;
            percentElement.textContent = `${cpu.usage.toFixed(1)}% Usage`;
            infoElement.innerHTML = `
                Name: ${cpu.name}<br>
                Frequency: ${cpu.frequency}<br>
                Cores: ${cpu.count}
            `;
            dynamicInfoElement.innerHTML = `
                <div class="value-box">Tasks: ${cpu.tasks}</div>
                <div class="value-box">Threads: ${cpu.threads}</div>
                <div class="value-box">Running: ${cpu.running}</div>
                <div class="value-box">Load Avg: ${cpu.load_average}</div>
            `;
            
            updateProgressColor(progress, cpu.usage);

            if (cpu.usage > cpuMax) {
                cpuMax = cpu.usage;
                maxLine.style.left = `${cpuMax}%`;
                maxLine.style.display = 'block';
            }
        }

        function updateMemoryMetric(memory) {
            const progress = document.getElementById('memoryProgress');
            const percentElement = document.getElementById('memoryPercent');
            const usageElement = document.getElementById('memoryUsage');
            const infoElement = document.getElementById('memoryInfo');
            const maxLine = document.getElementById('memoryMaxLine');
            
            progress.style.width = `${memory.percent}%`;
            percentElement.textContent = `${memory.percent.toFixed(1)}% Usage`;
            usageElement.textContent = `${memory.used} / ${memory.total}`;
            infoElement.innerHTML = `
                Total RAM: ${memory.total}<br>
                Swap Total: ${memory.swap_total}
            `;
            
            updateProgressColor(progress, memory.percent);

            if (memory.percent > memoryMax) {
                memoryMax = memory.percent;
                maxLine.style.left = `${memoryMax}%`;
                maxLine.style.display = 'block';
            }
        }

        function updateDiskMetric(disk) {
            const progress = document.getElementById('diskProgress');
            const percentElement = document.getElementById('diskPercent');
            const usageElement = document.getElementById('diskUsage');
            const infoElement = document.getElementById('diskInfo');
            const maxLine = document.getElementById('diskMaxLine');
            
            progress.style.width = `${disk.percent}%`;
            percentElement.textContent = `${disk.percent.toFixed(1)}% Usage`;
            usageElement.textContent = `${disk.used} / ${disk.total}`;
            infoElement.innerHTML = `
                Free: ${disk.free}<br>
                Read: ${disk.read}<br>
                Write: ${disk.write}
            `;
            
            updateProgressColor(progress, disk.percent);

            if (disk.percent > diskMax) {
                diskMax = disk.percent;
                maxLine.style.left = `${diskMax}%`;
                maxLine.style.display = 'block';
            }
        }

        function updateDiskIOMetric(diskIO) {
            const progress = document.getElementById('diskIOProgress');
            const percentElement = document.getElementById('diskIOPercent');
            const infoElement = document.getElementById('diskIOInfo');
            const maxLine = document.getElementById('diskIOMaxLine');
            
            if (diskIO && typeof diskIO.percent !== 'undefined') {
                progress.style.width = `${diskIO.percent}%`;
                percentElement.textContent = `${diskIO.percent.toFixed(1)}% Usage`;
                infoElement.innerHTML = `
                    Read: ${diskIO.read_speed}/s<br>
                    Write: ${diskIO.write_speed}/s
                `;
                
                updateProgressColor(progress, diskIO.percent);

                if (diskIO.percent > diskIOMax) {
                    diskIOMax = diskIO.percent;
                    maxLine.style.left = `${diskIOMax}%`;
                    maxLine.style.display = 'block';
                }
            } else {
                console.error('Invalid or missing diskIO data:', diskIO);
                infoElement.innerHTML = 'No data available';
            }
        }

        function updateNetworkMetric(network) {
            const progress = document.getElementById('networkProgress');
            const percentElement = document.getElementById('networkPercent');
            const infoElement = document.getElementById('networkInfo');
            const maxLine = document.getElementById('networkMaxLine');
            
            if (network && typeof network.percent !== 'undefined') {
                progress.style.width = `${network.percent}%`;
                percentElement.textContent = `${network.percent.toFixed(1)}% Usage`;
                infoElement.innerHTML = `
                    Sent: ${network.bytes_sent}/s<br>
                    Received: ${network.bytes_recv}/s
                `;
                
                updateProgressColor(progress, network.percent);

                if (network.percent > networkMax) {
                    networkMax = network.percent;
                    maxLine.style.left = `${networkMax}%`;
                    maxLine.style.display = 'block';
                }
            } else {
                console.error('Invalid or missing network data:', network);
                infoElement.innerHTML = 'No data available';
            }
        }

        function updateMetrics() {
            const selectedDisk = diskSelector.value;
            fetch(`/metrics?disk=${encodeURIComponent(selectedDisk)}`)
                .then(response => response.json())
                .then(data => {
                    console.log("Received data:", data);  // Keep this line
                    updateCPUMetric(data.cpu);
                    updateMemoryMetric(data.memory);
                    updateDiskMetric(data.disk);
                    updateDiskIOMetric(data.disk_io);
                    updateNetworkMetric(data.network);
                })
                .catch(error => {
                    console.error('Error fetching metrics:', error);
                    document.getElementById('diskIOInfo').innerHTML = 'Error fetching data';
                    document.getElementById('networkInfo').innerHTML = 'Error fetching data';
                });
        }

        function updateProgressColor(progressElement, value) {
            const hue = (1 - value / 100) * 120;
            progressElement.style.backgroundColor = `hsl(${hue}, 100%, 50%)`;
        }

        // Update metrics when disk selection changes
        diskSelector.addEventListener('change', updateMetrics);

        // Update metrics every second
        setInterval(updateMetrics, 1000);
    </script>
</body>
</html>
